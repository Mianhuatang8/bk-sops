apigateway:
  description: 标准运维（{{ settings.BK_APP_CODE }}）API 网关，包含了项目、流程、任务等资源的查询和操作接口
  description_en: {{ settings.BK_APP_CODE }} API Gateway, including query and operation interface of project, flow, task and other resources
  is_public: true
  api_type: 1
  maintainers:
    {% for member in settings.BK_APIGW_MANAGER_MAINTAINERS %}
    - "{{ member }}"
    {% endfor %}

stage:
  name: {{ settings.BK_APIGW_STAGE_NAME }}
  vars:
    api_sub_path: {{ settings.BK_APIGW_API_SERVER_SUB_PATH }}
    callback_sub_path: {{ settings.BK_APIGW_CALLBACK_SERVER_SUB_PATH }}
    callback_host: {{ settings.BK_APIGW_CALLBACK_SERVER_HOST }}
  proxy_http:
    timeout: 120
    upstreams:
      loadbalance: roundrobin
      hosts:
        - host: http://{{ settings.BK_APIGW_API_SERVER_HOST }}
          weight: 100
  rate_limit:
    enabled: false
    rate:
      tokens: 5000
      period: 60

resource_docs:
  # 资源文档的归档文件，可为 tar.gz，zip 格式文件；创建归档文件可使用指令 `tar czvf xxx.tgz en zh`
  # archivefile: "{{ settings.BK_APIGW_RESOURCE_DOCS_ARCHIVE_FILE }}"
  # 资源文档目录，basedir 与 archivefile 二者至少一个有效，若同时存在，则 archivefile 优先
  # basedir: "{{ settings.BK_APIGW_RESOURCE_DOCS_BASE_DIR }}"
  archivefile: {{ settings.BK_APIGW_RESOURCE_DOCS_ARCHIVE_FILE }}

release:
  version: {{ settings.APIGW_DOCS_VERSION }}
  comment: "auto release by bk-sops"


grant_permissions:
  - bk_app_code: "bk_bcs_app"
    grant_dimension: "resource"
    resource_names:
      - system_create_task
      - system_start_task
      - system_get_tasks_status
      - system_get_template_list
      - system_get_user_project_detail
      - system_get_template_info
      - system_operate_task
  - bk_app_code: "bk_monitorv3"
    grant_dimension: "resource"
    resource_names:
      - system_get_user_project_detail
      - system_get_template_list
      - system_get_template_info
      - system_preview_task_tree
      - system_create_task
      - system_start_task
      - system_get_task_status
      - system_import_project_template
  - bk_app_code: "bk_nodeman"
    grant_dimension: "resource"
    resource_names:
      - system_create_task
      - system_start_task
      - system_get_task_status